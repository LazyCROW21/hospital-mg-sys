<p-card>
    <p-tabView (onChange)="onTabChange($event)">
        <p-tabPanel header="New Users">
            <ng-template [ngIf]="isLoadingNewUsers" [ngIfElse]="notLoadingNewUsers">
                <p class="text-center">Loading..</p>
                <p-progressBar mode="indeterminate"></p-progressBar>
            </ng-template>
            <ng-template #notLoadingNewUsers>
                <p-table [value]="newUsers" responsiveLayout="scroll">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Gender</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th class="text-center">Type</th>
                            <th></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-user let-i="rowIndex">
                        <tr>
                            <td>{{ i + 1 }}</td>
                            <td>{{ user.firstName + ' ' + user.lastName }}</td>
                            <td>{{ user.gender }}</td>
                            <td>{{ user.email }}</td>
                            <td>{{ user.phone }}</td>
                            <td class="text-center">
                                <p-badge [value]="user.role === 'D' ? 'Doctor' : 'Patient'"
                                    [severity]="user.role === 'D' ? 'success' : 'info'"></p-badge>
                            </td>
                            <td class="text-right">
                                <p-button styleClass="p-button-text" icon="pi pi-ellipsis-v"
                                    (onClick)="setActiveUser(i); newUserPMenu.toggle($event);"></p-button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
                <p-menu #newUserPMenu [popup]="true" [model]="newUserMenu"></p-menu>
            </ng-template>
        </p-tabPanel>
        <p-tabPanel header="Patients">
            <ng-template [ngIf]="isLoadingPatients" [ngIfElse]="notLoadingPatients">
                <app-loading-bar></app-loading-bar>
            </ng-template>
            <ng-template #notLoadingPatients>
                <app-patient-table [patients]="patients" (onMenuAction)="onPatientTableAction($event)"></app-patient-table>
            </ng-template>
        </p-tabPanel>
        <p-tabPanel header="Doctors">
            <ng-template [ngIf]="isLoadingDoctors" [ngIfElse]="notLoadingDoctors">
                <app-loading-bar></app-loading-bar>
            </ng-template>
            <ng-template #notLoadingDoctors>
                <app-doctor-table [doctors]="doctors" (onMenuAction)="onDoctorTableAction($event)"></app-doctor-table>
            </ng-template>
        </p-tabPanel>
    </p-tabView>
</p-card>

<!-- Create Department Dialog -->
<p-dialog [(visible)]="dialog.show" [header]="dialog.header" [style]="{ maxWidth: '80%' }">
    <table class="my-table">
        <tbody>
            <tr>
                <th>Type:</th>
                <td>
                    <p-badge [value]="activeUser?.role === 'D' ? 'Doctor' : 'Patient'"
                        [severity]="activeUser?.role === 'D' ? 'success' : 'info'"></p-badge>
                </td>
            </tr>
            <tr>
                <th>User ID:</th>
                <td>{{ activeUser?.id }}</td>
            </tr>
            <tr>
                <th>First Name:</th>
                <td>{{ activeUser?.firstName }}</td>
            </tr>
            <tr>
                <th>Last Name:</th>
                <td>{{ activeUser?.lastName }}</td>
            </tr>
            <tr>
                <th>Email:</th>
                <td>{{ activeUser?.email }}</td>
            </tr>
            <tr>
                <th>Phone:</th>
                <td>{{ activeUser?.phone }}</td>
            </tr>
            <tr>
                <th>Emergency Phone:</th>
                <td>{{ activeUser?.emergencyPhone }}</td>
            </tr>
            <tr>
                <th>Gender:</th>
                <td>{{ activeUser?.gender }}</td>
            </tr>
            <tr>
                <th>Date of Birth:</th>
                <td>{{ activeUser?.dob | date:'short' }}</td>
            </tr>
            <tr>
                <th>Address Line 1:</th>
                <td>{{ activeUser?.line1 }}</td>
            </tr>
            <tr>
                <th>Address Line 2:</th>
                <td>{{ activeUser?.line2 }}</td>
            </tr>
            <tr>
                <th>Address PINCODE:</th>
                <td>{{ activeUser?.pincode }}</td>
            </tr>
            <tr>
                <th>Address City:</th>
                <td>{{ activeUser?.city }}</td>
            </tr>
            <tr>
                <th>Address State:</th>
                <td>{{ activeUser?.state }}</td>
            </tr>
            <ng-template [ngIf]="activeUser?.role === 'D'">
                <p-divider></p-divider>
                <tr>
                    <th>Specialization:</th>
                    <td>{{ activeUser?.specialization }}</td>
                </tr>
                <tr>
                    <th>Experience:</th>
                    <td>{{ activeUser?.experience }}</td>
                </tr>
            </ng-template>
        </tbody>
    </table>
    <div *ngIf="dialog.mode === 'N'" class="flex justify-content-end gap-2 mt-2">
        <p-button label="Close" icon="pi pi-times" styleClass="p-button-plain p-button-text"
            (onClick)="dialog.show = false;">
        </p-button>
        <p-button label="Reject" (onClick)="commitUserStatus('R')" [icon]="commitButtonIcons['R']"
            styleClass="p-button-danger p-button-text">
        </p-button>
        <p-button label="Accept" (onClick)="commitUserStatus('A')" [icon]="commitButtonIcons['A']"
            styleClass="p-button-success p-button-text">
        </p-button>
    </div>
</p-dialog>

<!-- Delete Department Popup -->
<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>